#? stdtmpl | standard
#proc generate_pkg_page(pkg: Pkg): string =
#  result = ""

# let pname = pkg["name"].str

    
<div class="pkg-info">
  <div class="container medium">



    <h3 class="pkg-title"> ${pname} </h3>
    <p class="tags">
    #for tag in pkg["tags"]:
        
        <a href="/search?query=$tag.str"><span class="tag"> $tag.str</span></a>
        
    #end for
    </p>
    <p class="pkg-desc">${pkg["description"].str}</p>
    #if pkg.has_key("github_owner"):
          <p class="pkg-author">Author:  <a href="https://github.com/${pkg["github_owner"].str}">${pkg["github_owner"].str}</a></p>
    #end

    <a title="Copy" onclick="document.querySelector('#cmd').select();document.execCommand('copy');" alt="Copy on clipboard">
        <i class="fa fa-copy"></i></a> <input id="cmd" onclick="this.select();" value="nimble install ${pname} " readonly="">
        <p><small>Need help? Read <a href="https://github.com/nim-lang/nimble#creating-packages">Nimble</a></small></p>
      <hr>   
    
    

    <p>
    #if pkg.has_key("github_versions"):
        #if pkg["github_versions"].getElems().len > 0:
          Available versions:
        #  for semver in pkg["github_versions"].getElems():
            <span class="tag">${semver.str}</span>
        #  end

        #else:
          No tagged versions available
        #end
    #end
    </p>
    <p>License:
    #     let licns = pkg["license"].str.toLowerAscii.strip
    #     if licns == "mit":
            <a href="https://opensource.org/licenses/MIT">MIT</a>
    #     elif licns == "apache2" or licns == "apache":
            <a href="https://opensource.org/licenses/Apache-2.0">Apache 2</a>
    #     elif licns == "bsd":
            <a href="https://opensource.org/licenses/BSD-2-Clause">BSD</a>
    #     elif licns == "bsd2" or licns == "bsd 2-clause":
            <a href="https://opensource.org/licenses/BSD-2-Clause">BSD 2-Clause</a>
    #     elif licns == "bsd3" or licns == "bsd 3-clause":
            <a href="https://opensource.org/licenses/BSD-3-Clause">BSD 3-Clause</a>
    #     elif licns == "gplv2":
            <a href="https://opensource.org/licenses/GPL-2.0">GPL 2</a>
    #     elif licns == "gplv3":
            <a href="https://opensource.org/licenses/GPL-3.0">GPL 3</a>
    #     elif licns == "gpl":
            <a href="https://opensource.org/licenses/GPL-3.0">GPL</a>
    #     elif licns == "lgplv2":
            <a href="https://opensource.org/licenses/LGPL-2.0">LGPL 2</a>
    #     elif licns == "lgplv3":
            <a href="https://opensource.org/licenses/LGPL-3.0">LGPL 3</a>
    #     elif licns == "lgpl":
            <a href="https://opensource.org/licenses/LGPL-3.0">LGPL</a>
    #     elif licns == "cc0":
            <a href="https://creativecommons.org/publicdomain/zero/1.0">Creative Commons Zero</a>
    #     elif licns == "cc" or licns == "cc-by-nc-sa" or licns == "cc-by-nc-nd":
            <a href="https://creativecommons.org/licenses">Creative Commons</a>
    #     elif licns == "wtfpl":
            <a href="http://www.wtfpl.net">WTFPL</a>
    #     else:
            ${pkg["license"].str}
    #     end
    </p>
    



          <p>
          <a href="/ci/badges/${pname}/nimdevel/output.html">
            <img class="slickbadge" id="versionbadge">
          </a>
          <a href="/ci/badges/${pname}/nimdevel/output.html">
            <img class="slickbadge" id="statusbadge">
          </a>
          <a href="/ci/badges/${pname}/nimdevel/doc_build_output.html">
            <img class="slickbadge" id="docstatusbadge">
          </a>
          </p> 
        <button class="pkg-btn" id="rebuildbtn">Rebuild now</button>
        
        
        
     

    
        #if pkg.has_key("web"):
          <a href="${pkg["web"].str}">
          <button class="pkg-btn">Project website</button>
          </a>
        #end
        #if pkg.has_key("doc"):
          <a href="${pkg["doc"].str}">
          <button class="pkg-btn">Docs</button>
          </a>
        #end if
        #let url = pkg["url"].str
        #if url.startswith("https://github.com/") or url.startswith("http://github.com/") or url.startswith("git"):
          <a href="/docs/${pname}">
          <button class="pkg-btn">Hosted docs</button>
          </a>
        #end if

        <script>
          function reload_badges() {
            $$("#versionbadge").attr("src", "/ci/badges/${pname}/version.svg");
            $$("#statusbadge").attr("src", "/ci/badges/${pname}/nimdevel/status.svg");
            $$("#docstatusbadge").attr("src", "/ci/badges/${pname}/nimdevel/docstatus.svg");
          }
          function reload_rebuildbtn() {
            $$.getJSON( "/api/v1/status/${pname}", function(resp) {
              if (resp.status == "building") {
                $$("#rebuildbtn").addClass("loading");
              } else {
                $$("#rebuildbtn").removeClass("loading");
                $$("#last_build_time").html("Last build time: " + resp.build_time);
                reload_badges();
              }
            });
          }
          $$("#rebuildbtn").click(function() {
            $$.post("/ci/rebuild/${pname}");
            $$("#rebuildbtn").addClass("loading");
          });
          setInterval(reload_rebuildbtn, 5000);
          reload_rebuildbtn();
        </script>



          <br>
          <form action="/searchitem_pkg" method="GET" role="search" class="input-group" id="searchitem">
            <input id="search-pkg" class="form-input" name="query" placeholder="Search symbol in ${pname}" type="search" value="" minlength="1" autofocus required >
            <input class="form-input" name="pkg_name" type="hidden" value="${pname}">
            
          </form>
        
     
        <div id="searchitem_result">
        </div>
   </div>
  </div>
  <hr>
    <div class="readme-section">
    <div class="container medium">
    #if pkg.has_key("github_readme"):
        ${pkg["github_readme"].str}
    #end
   


        <script>
          $$("#searchitem").submit(function(event) {
            var data = $$("#searchitem :input").serializeArray();
            $$("#searchitem_result").load("/searchitem_pkg", data);
            event.preventDefault();
          });
        </script>
     </div>
    </div>

<!-- TODO: Dom: IMO this shouldn't be shown -->
#if pkg.has_key("github_latest_version_time"):
<!--<small>Released on ${pkg["github_latest_version_time"].str}</small>-->
#end if
